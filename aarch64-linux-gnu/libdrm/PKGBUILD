# Maintainer: Tilmann Meyer <tilmann.meyer@gmx.net>

_target=aarch64-linux-gnu

_pkgname=libdrm
pkgname=$_target-$_pkgname
pkgver=2.4.100
pkgrel=1
pkgdec='Userspace interface to kernel DRM services (ARM64)'
arch=(x86_64)
url='https://dri.freedesktop.org/'
licenses=('custom')
depends=($_target-gcc)
makedepends=($_target-meson)
options=(!buildflags)
source=(
  https://dri.freedesktop.org/$_pkgname/$_pkgname-$pkgver.tar.bz2{,.sig}
)
sha256sums=(
  'c77cc828186c9ceec3e56ae202b43ee99eb932b4a87255038a80e8a1060d0a5d'
  'SKIP'
)
validpgpkeys=(
  'B97BD6A80CAC4981091AE547FE558C72A67013C3' # Maarten Lankhorst <maarten.lankhorst@canonical.com>
  '215DEE688925CCB965BE5DA97C03D7797B6E1AE2' # Damien Lespiau <damien.lespiau@intel.com>
  '10A6D91DA1B05BD29F6DEBAC0C74F35979C486BE' # David Airlie <airlied@redhat.com>
  '8703B6700E7EE06D7A39B8D6EDAE37B02CEB490D' # Emil Velikov <emil.l.velikov@gmail.com>
  'D6285B5E899299F3DA746184191C9B905522B045' # Rob Clark <robclark@freedesktop.org>
  'E8EB5B34081CE1EEA26EFE195B5BDA071D49CC38' # Kenneth Graunke <kenneth.w.graunke@intel.com>
  'FC9BAE1435A9F7F664B82057B5D62936D1FC9EE8' # Eric Anholt <eric@anholt.net>
  '3BB639E56F861FA2E86505690FDD682D974CA72A' # Matt Turner <mattst88@gmail.com>
  'C20F5C4490D7D64B4C9A09998CD1DF552975297B' # Robert Bragg <robert@sixbynine.org>
  'CD47C5341A375F33BEF7BAFAFDD15D5ACEF0F2B1' # Marek Olšák <maraeo@gmail.com>
  'A66D805F7C9329B4C5D82767CCC4F07FAC641EFF' # Daniel Stone <daniels@collabora.com>
  'CFD0E654BCBE5DD2D030D222CFCC297C6D0A120B' # Lucas Stach <l.stach@pengutronix.de>
)

_srcdir=$_pkgname-$pkgver

strip() {
  ${_target}-strip "$@"
}

objcopy() {
  ${_target}-objcopy "$@"
}

check() {
  cd $_srcdir

  ninja -C build-$_target test
}

build() {
  cd $_srcdir

  $_target-meson build-$_target
  ninja -C build-$_target
}

package() {
  cd $_srcdir

  DESTDIR="$pkgdir" ninja -C build-$_target install
}
